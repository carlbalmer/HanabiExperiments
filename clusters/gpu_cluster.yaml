cluster_name: basic-gpu

max_workers: 1
min_workers: 1

provider:
    type: gcp
    region: us-central1
    availability_zone: us-central1-a
    project_id: hanabi-ma-thesis

auth:
    ssh_user: ubuntu

head_node:
    machineType: n1-standard-8
    disks:
      - boot: true
        autoDelete: true
        type: PERSISTENT
        initializeParams:
          diskSizeGb: 50
          sourceImage: projects/deeplearning-platform-release/global/images/family/tf-1-15-cu100
    guestAccelerators:
      - acceleratorType: projects/hanabi-ma-thesis/zones/us-central1-a/acceleratorTypes/nvidia-tesla-k80
        acceleratorCount: 1
    metadata:
      items:
        - key: install-nvidia-driver
          value: "True"
    scheduling:
      - preemptible: true

worker_nodes:
    machineType: n1-highcpu-64
    disks:
      - boot: true
        autoDelete: true
        type: PERSISTENT
        initializeParams:
          diskSizeGb: 50
          sourceImage: projects/deeplearning-platform-release/global/images/family/tf-1-15-cu100
    scheduling:
      - preemptible: true

setup_commands:
  - >-
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3.sh
    || true
    && bash ~/miniconda3.sh -b -p ~/miniconda3 || true
    && rm ~/miniconda3.sh
    && echo 'export PATH="$HOME/miniconda3/bin:$PATH"' >> ~/.profile

  - pip install -U https://s3-us-west-2.amazonaws.com/ray-wheels/latest/ray-0.8.0.dev6-cp37-cp37m-manylinux1_x86_64.whl
  - pip install ray[rllib,debug] gputil tensorflow==1.15.0 git+https://github.com/carlbalmer/hanabi-learning-environment.git


file_mounts: {
    "~/": ".",
}